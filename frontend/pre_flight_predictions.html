<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Smart Plate - Pre-Flight Predictions</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
      :root {
        --bs-primary: #070769;
        --bs-primary-rgb: 7,7,105;
      }
      body {
        display: flex;
        flex-direction: column;
        min-height: 100vh;
      }
      .main-content {
        flex: 1;
        padding-bottom: 2rem;
      }
      #chatButton {
        position: fixed;
        bottom: 20px;
        right: 20px;
        z-index: 1050;
        width: 60px;
        height: 60px;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      #chatWindow {
        position: fixed;
        bottom: 90px;
        right: 20px;
        z-index: 1055;
        width: 400px;
        max-width: 90vw;
      }
       footer {
         margin-top: auto;
       }
       
       /* Header gradient */
       .header-gradient {
         background: linear-gradient(135deg, #070769 0%, #2d2d9e 50%, #070769 100%);
         position: relative;
         overflow: hidden;
       }
       
       .header-gradient::before {
         content: '';
         position: absolute;
         top: -50%;
         right: -10%;
         width: 50%;
         height: 200%;
         background: radial-gradient(ellipse, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
         pointer-events: none;
       }
       
       /* Card improvements */
       .card {
         box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
         border: 1px solid rgba(0, 0, 0, 0.125);
         border-radius: 15px;
         transition: all 0.3s ease-in-out;
         animation: fadeInUp 0.6s ease-out;
       }
       
       .card:hover {
         box-shadow: 0 1rem 2rem rgba(0, 0, 0, 0.2);
         transform: translateY(-5px);
       }
       
       .card-header {
         border-bottom: 1px solid rgba(0, 0, 0, 0.125);
         border-radius: 15px 15px 0 0;
       }
       
       @keyframes fadeInUp {
         from {
           opacity: 0;
           transform: translateY(30px);
         }
         to {
           opacity: 1;
           transform: translateY(0);
         }
       }
       
       /* Form improvements */
       .form-control, .form-select {
         border-radius: 10px;
         border: 2px solid #e0e0e0;
         transition: all 0.3s ease-in-out;
       }
       
       .form-control:focus, .form-select:focus {
         border-color: #070769;
         box-shadow: 0 0 0 0.2rem rgba(7, 7, 105, 0.1);
       }
       
       /* Button styles */
       .btn {
         border-radius: 10px;
         transition: all 0.3s ease-in-out;
         font-weight: 500;
       }
       
       .btn:hover {
         transform: translateY(-2px);
         box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
       }
       
       /* Badge styling */
       .badge {
         border-radius: 20px;
         font-weight: 500;
         box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
       }
       
       /* Table improvements */
       .table {
         border-radius: 10px;
         overflow: hidden;
       }
       
       .table thead th {
         background-color: #f8f9fa !important;
         font-weight: 600;
         text-transform: uppercase;
         font-size: 0.85rem;
         letter-spacing: 0.5px;
       }
       
       .table tbody tr:hover {
         background-color: #f8f9fa;
         transform: scale(1.01);
       }
       
       /* Selected products list */
       #selectedProductsList {
         list-style-type: none;
         padding-left: 0;
       }
       
       #selectedProductsList li {
         background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
         margin-bottom: 10px;
         padding: 12px 15px;
         border-radius: 10px;
         display: flex;
         justify-content: space-between;
         align-items: center;
         border-left: 4px solid #070769;
         transition: all 0.3s ease-in-out;
       }
       
       #selectedProductsList li:hover {
         transform: translateX(5px);
         box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
       }
       
       #selectedProductsList button {
         padding: 0.3rem 0.8rem;
         font-size: 0.85rem;
         border-radius: 8px;
         transition: all 0.2s ease-in-out;
       }
       
       /* Section improvements */
       .form-section {
         background: #f8f9fa;
         padding: 2rem;
         border-radius: 15px;
         margin-bottom: 2rem;
         border: 1px solid #e0e0e0;
       }
       
       h4, h5 {
         color: #070769;
         font-weight: 600;
       }
       
       /* Loading spinner */
       .spinner-border {
         animation: spin 1s linear infinite;
       }
       
       @keyframes spin {
         0% { transform: rotate(0deg); }
         100% { transform: rotate(360deg); }
       }
       
       /* Result card styling */
       #predictionResultArea .card {
         border-left: 5px solid #070769;
       }
       
       #predictionResultArea .card-header {
         background: linear-gradient(135deg, #070769 0%, #2d2d9e 100%);
         color: white;
       }
       
       /* Mobile responsiveness */
       @media (max-width: 768px) {
         .form-section {
           padding: 1rem;
         }
       }
       
       /* Ensure error message is hidden by default */
       #productSelectionError {
         display: none !important;
       }
       
       /* Navbar brand hover animation */
       .navbar-brand {
         transition: all 0.3s ease-in-out;
       }
       
       .navbar-brand:hover {
         transform: scale(1.05);
       }
       
       .navbar-brand:hover span {
         text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
       }
       
       /* Menu toggle button hover animation */
       .navbar-toggler {
         transition: all 0.3s ease-in-out;
       }
       
       .navbar-toggler:hover {
         transform: scale(1.05);
         box-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
       }
       
       /* Skeleton Loading Animation */
       @keyframes skeleton-pulse {
         0% {
           background-color: #f0f0f0;
         }
         50% {
           background-color: #e0e0e0;
         }
         100% {
           background-color: #f0f0f0;
         }
       }
       
       .skeleton {
         animation: skeleton-pulse 1.5s ease-in-out infinite;
         border-radius: 10px;
       }
       
       /* Fade in animations */
       @keyframes fadeIn {
         from {
           opacity: 0;
         }
         to {
           opacity: 1;
         }
       }
       
       @keyframes slideInUp {
         from {
           opacity: 0;
           transform: translateY(30px);
         }
         to {
           opacity: 1;
           transform: translateY(0);
         }
       }
       
       .fade-in {
         animation: fadeIn 0.5s ease-out;
       }
       
       .slide-in-up {
         animation: slideInUp 0.6s ease-out;
       }
       
       /* Stagger animation for product items */
       #selectedProductsList li {
         animation: slideInUp 0.4s ease-out;
       }
       
       /* Pulse animation for loading */
       @keyframes pulse {
         0%, 100% {
           opacity: 1;
         }
         50% {
           opacity: 0.5;
         }
       }
       
       .pulse {
         animation: pulse 2s ease-in-out infinite;
       }
       
       /* Success animation */
       @keyframes successSlide {
         0% {
           transform: translateX(-100%);
           opacity: 0;
         }
         50% {
           transform: translateX(10px);
           opacity: 1;
         }
         100% {
           transform: translateX(0);
           opacity: 1;
         }
       }
       
       .success-slide {
         animation: successSlide 0.6s ease-out;
       }
       
       /* Shake animation for errors */
       @keyframes shake {
         0%, 100% { transform: translateX(0); }
         25% { transform: translateX(-10px); }
         75% { transform: translateX(10px); }
       }
       
       .shake {
         animation: shake 0.5s ease-in-out;
       }
       
       /* Scale animation for buttons */
       @keyframes scaleIn {
         from {
           transform: scale(0.9);
           opacity: 0;
         }
         to {
           transform: scale(1);
           opacity: 1;
         }
       }
       
       .scale-in {
         animation: scaleIn 0.3s ease-out;
       }
       
       /* Form field animations */
       .form-control:focus, .form-select:focus {
         animation: scaleIn 0.2s ease-out;
       }
       
       /* Card entrance animation */
       .card {
         animation: fadeInUp 0.6s ease-out;
       }
       
       /* Add product button animation */
       #addProductBtn {
         transition: all 0.3s ease;
       }
       
       #addProductBtn:hover {
         transform: translateY(-2px) scale(1.02);
       }
       
       /* Submit button animation */
       button[type="submit"] {
         position: relative;
         overflow: hidden;
       }
       
       button[type="submit"]::before {
         content: '';
         position: absolute;
         top: 0;
         left: -100%;
         width: 100%;
         height: 100%;
         background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
         transition: left 0.5s;
       }
       
       button[type="submit"]:hover::before {
         left: 100%;
       }
       
       /* Result area animations */
       #predictionResultArea {
         transition: all 0.5s ease-out;
       }
       
       #predictionResultArea .card {
         animation: slideInUp 0.8s ease-out;
       }
       
       /* Table row animations */
       table tbody tr {
         animation: fadeIn 0.3s ease-out;
       }
       
       /* Remove button animation */
       #selectedProductsList button {
         transition: all 0.2s ease;
       }
       
       #selectedProductsList button:hover {
         transform: scale(1.1);
       }
       
       /* Input focus animation */
       .form-control:not(:placeholder-shown) {
         background-color: #f8f9fa;
       }
       
       /* Animate validation errors */
       .is-invalid {
         animation: shake 0.5s ease-in-out;
       }
       
       /* Loading overlay */
       .loading-overlay {
         position: fixed;
         top: 0;
         left: 0;
         width: 100%;
         height: 100%;
         background: rgba(0, 0, 0, 0.5);
         display: flex;
         justify-content: center;
         align-items: center;
         z-index: 9999;
         animation: fadeIn 0.3s ease-out;
       }
       
       .loading-content {
         background: white;
         padding: 2rem;
         border-radius: 15px;
         text-align: center;
       }
    </style>
</head>

<body>

    <nav class="navbar navbar-dark bg-primary sticky-top">
      <div class="container-fluid">
        <button class="navbar-toggler" type="button" data-bs-toggle="offcanvas" data-bs-target="#menuSidebar" aria-controls="menuSidebar">
          <span class="navbar-toggler-icon"></span>
        </button>
        <a class="navbar-brand d-flex align-items-center" href="index.html">
          <img src="media_files/gategroup_logo.jpg" alt="Gategroup Logo" height="28" class="me-2" style="object-fit: contain;">
          <span class="fw-bold" style="font-size: 1.25rem; letter-spacing: 0.02em; margin-top: -3px;">Smart Plate</span>
        </a>
      </div>
    </nav>

    <div class="offcanvas offcanvas-start" tabindex="-1" id="menuSidebar" aria-labelledby="menuSidebarLabel">
      <div class="offcanvas-header">
        <h5 class="offcanvas-title" id="menuSidebarLabel">Menu</h5>
        <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
      </div>
      <div class="offcanvas-body">
        <ul class="nav flex-column nav-pills">
          <li class="nav-item">
            <a class="nav-link" href="index.html">Home</a>
          </li>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" data-bs-toggle="dropdown" href="#" role="button" aria-expanded="false">
              Expiration
            </a>
            <ul class="dropdown-menu">
              <li><a class="dropdown-item" href="exp_adding.html">Exp - Adding</a></li>
              <li><a class="dropdown-item" href="exp_dashboard.html">Exp - Dashboard</a></li>
            </ul>
          </li>
          <li class="nav-item">
            <a class="nav-link active" aria-current="page" href="pre_flight_predictions.html">Pre-Flight Predictions</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">Other Link</a>
          </li>
        </ul>
      </div>
    </div>

    <div class="container-fluid mt-4 main-content">
      <!-- Header Section -->
      <div class="row mb-4">
        <div class="col-12">
          <div class="header-gradient p-4 rounded-4 shadow-sm mb-4">
            <div>
              <h1 class="text-white mb-2 fw-bold">
                <i class="fas fa-plane me-2"></i>Pre-Flight Predictions
              </h1>
              <p class="text-white-50 mb-0">Analyze flight data and predict product consumption</p>
            </div>
          </div>
        </div>
      </div>

      <div class="row mb-5">
        <div class="col-12">
          <div class="form-section">
          <h2 class="mb-4"><i class="fas fa-info-circle me-2"></i>Input Flight Information</h2>
          <form id="prediction-form" novalidate>
            <div class="row g-3 mb-4 border-bottom pb-3">
               <div class="col-md-6">
                 <label for="flightId" class="form-label">Flight-ID</label>
                 <input type="text" class="form-control" id="flightId" required maxlength="7">
                 <div class="invalid-feedback">Please provide a Flight ID (max 7 characters).</div>
               </div>
               <div class="col-md-6">
                 <label for="origin" class="form-label">Origin</label>
                 <input type="text" class="form-control" id="origin" required maxlength="4">
                 <div class="invalid-feedback">Please provide an Origin code (max 4 characters).</div>
               </div>
               <div class="col-md-6">
                 <label for="flightType" class="form-label">Flight Type</label>
                 <input type="text" class="form-control" id="flightType" required placeholder="e.g., short-haul">
                 <div class="invalid-feedback">Must be 'short-haul', 'medium-haul', or 'long-haul'.</div>
               </div>
               <div class="col-md-6">
                 <label for="serviceType" class="form-label">Service Type</label>
                 <input type="text" class="form-control" id="serviceType" required placeholder="Retail or Pick & Pack">
                 <div class="invalid-feedback">Must be 'Retail' or 'Pick & Pack'.</div>
               </div>
               <div class="col-md-6">
                 <label for="passengerCount" class="form-label">Passenger Count</label>
                 <input type="number" class="form-control" id="passengerCount" required min="2" max="999">
                 <div class="invalid-feedback">Must be a number between 2 and 999.</div>
               </div>
            </div>

            <h4 class="mt-4">Select Products for Analysis</h4>
            <div class="row g-3 align-items-end mb-3">
                <div class="col-md-8">
                    <label for="productSelect" class="form-label">Available Products</label>
                    <select class="form-select" id="productSelect">
                        <option selected disabled value="">Choose a product...</option>
                        </select>
                </div>
                <div class="col-md-4">
                    <button type="button" class="btn btn-secondary w-100" id="addProductBtn">Add Product</button>
                </div>
            </div>

            <h5>Selected Products:</h5>
            <ul id="selectedProductsList">
                <li id="noProductsMsg" class="text-muted">No products added yet.</li>
            </ul>
             <div class="invalid-feedback d-block text-danger" id="productSelectionError" style="display: none;">
              <i class="fas fa-exclamation-triangle me-2"></i>Please add at least one product.
            </div>


            <div class="col-12 mt-4">
                 <button type="submit" class="btn btn-primary btn-lg">
                   <i class="fas fa-chart-line me-2"></i>Get Prediction
                 </button>
            </div>
          </form>
          </div>
        </div>
      </div>
      <div class="row mt-5">
        <div class="col-12">
          <div class="card">
            <div class="card-header bg-primary text-white">
              <h3 class="mb-0"><i class="fas fa-clipboard-list me-2"></i>Prediction for Flight <span id="predictedFlightId">[Flight ID]</span></h3>
            </div>
            <div class="card-body p-4">
              <div id="predictionResultArea">
                <p class="text-muted">Enter flight details and add products above to get predictions.</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <button class="btn btn-primary btn-lg rounded-circle shadow" type="button" id="chatButton" data-bs-toggle="collapse" data-bs-target="#chatWindow" aria-expanded="false" aria-controls="chatWindow">
      <img src="media_files/gemini_logo.png" alt="Gemini Logo" width="30" height="30" style="filter: brightness(0) invert(1);">
    </button>
    <div class="collapse" id="chatWindow">
       <div class="card shadow-lg">
         <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
           <span>Chat Assistant</span>
           <button type="button" class="btn-close btn-close-white" data-bs-toggle="collapse" data-bs-target="#chatWindow" aria-label="Close"></button>
         </div>
         <div class="card-body" style="height: 400px; overflow-y: scroll;">
           <p><b>Assistant:</b> Hello! How can I help you?</p>
         </div>
         <div class="card-footer d-flex">
           <input type="text" class="form-control" placeholder="Type your message...">
           <button class="btn btn-primary ms-2">Send</button>
         </div>
       </div>
    </div>

    <footer class="bg-dark text-white p-5">
      <div class="container">
        <div class="row">
          <div class="col-md-3 mb-4">
            <h5 class="mb-3">Smart Plate</h5>
            <p class="text-white-50">Copyright &copy; 2025 Gategroup. <br>All rights reserved.</p>
          </div>
          <div class="col-md-3 mb-4">
            <h5>Explore</h5>
            <ul class="nav flex-column">
              <li class="nav-item mb-2"><a href="index.html" class="nav-link p-0 text-white-50">Home</a></li>
              <li class="nav-item mb-2"><a href="exp_dashboard.html" class="nav-link p-0 text-white-50">Dashboard</a></li>
              <li class="nav-item mb-2"><a href="pre_flight_predictions.html" class="nav-link p-0 text-white-50">Predictions</a></li>
              <li class="nav-item mb-2"><a href="#" class="nav-link p-0 text-white-50">About Us</a></li>
            </ul>
          </div>
          <div class="col-md-3 mb-4">
            <h5>Global Headquarters</h5>
            <address class="text-white-50" style="font-style: normal;">
              Gategroup<br>
              Street Address 123<br>
              Zurich, Switzerland
            </address>
          </div>
          <div class="col-md-3 mb-4">
            <h5>Legal</h5>
            <ul class="nav flex-column">
              <li class="nav-item mb-2"><a href="#" class="nav-link p-0 text-white-50">Terms & Conditions</a></li>
              <li class="nav-item mb-2"><a href="#" class="nav-link p-0 text-white-50">Data Privacy</a></li>
            </ul>
          </div>
        </div>
      </div>
    </footer>

    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      // --- Available Products Data (Extracted from CSV) ---
      const availableProducts = {
        'Bread Roll Pack': 0.35,
        'Butter Cookies 75g': 0.75,
        'Sparkling Water 330ml': 0.45,
        'Still Water 500ml': 0.5,
        'Chocolate Bar 50g': 0.8,
        'Herbal Tea Bag': 0.06,
        'Juice 200ml': 0.55,
        'Snack Box Economy': 2.1,
        'Instant Coffee Stick': 0.08
        // Add more products here if needed
      };

      // --- DOM Elements ---
      const form = document.getElementById('prediction-form');
      const flightIdInput = document.getElementById('flightId');
      const originInput = document.getElementById('origin');
      const flightTypeInput = document.getElementById('flightType');
      const serviceTypeInput = document.getElementById('serviceType');
      const passengerCountInput = document.getElementById('passengerCount');
      const productSelect = document.getElementById('productSelect');
      const addProductBtn = document.getElementById('addProductBtn');
      const selectedProductsList = document.getElementById('selectedProductsList');
      const noProductsMsg = document.getElementById('noProductsMsg');
      const productSelectionError = document.getElementById('productSelectionError');
      const predictedFlightIdSpan = document.getElementById('predictedFlightId');
      const predictionResultArea = document.getElementById('predictionResultArea');

      // --- State for Selected Products ---
      let selectedProductsData = []; // Array to store { name: '...', cost: ... }

      // --- Populate Product Dropdown ---
      function populateProductDropdown() {
          Object.keys(availableProducts).sort().forEach(productName => {
              const option = document.createElement('option');
              option.value = productName;
              option.textContent = `${productName} ($${availableProducts[productName].toFixed(2)})`;
              productSelect.appendChild(option);
          });
      }

      // --- Update Display of Selected Products ---
      function updateSelectedProductsDisplay() {
          selectedProductsList.innerHTML = ''; // Clear current list
          if (selectedProductsData.length === 0) {
              selectedProductsList.appendChild(noProductsMsg); // Show 'No products' message
               productSelectionError.style.display = 'none'; // Hide error initially
          } else {
              noProductsMsg.remove(); // Hide 'No products' message
               productSelectionError.style.display = 'none'; // Hide error if products are added
              selectedProductsData.forEach((product, index) => {
                  const li = document.createElement('li');
                  li.classList.add('scale-in'); // Add scale animation
                  li.textContent = `${product.name} ($${product.cost.toFixed(2)})`;

                  const removeBtn = document.createElement('button');
                  removeBtn.textContent = 'Remove';
                  removeBtn.type = 'button';
                  removeBtn.classList.add('btn', 'btn-sm', 'btn-outline-danger');
                  removeBtn.onclick = () => removeProduct(index); // Add remove functionality

                  li.appendChild(removeBtn);
                  selectedProductsList.appendChild(li);
              });
          }
      }

      // --- Add Product Functionality ---
      addProductBtn.addEventListener('click', () => {
          const selectedName = productSelect.value;
          if (selectedName && availableProducts[selectedName] !== undefined) {
              // Check if product is already added
              const isAlreadyAdded = selectedProductsData.some(p => p.name === selectedName);
              if (!isAlreadyAdded) {
                  selectedProductsData.push({
                      name: selectedName,
                      cost: availableProducts[selectedName]
                  });
                  updateSelectedProductsDisplay();
                  productSelect.selectedIndex = 0; // Reset dropdown
              } else {
                  alert(`${selectedName} is already added.`); // Optional: User feedback
              }
          }
      });

      // --- Remove Product Functionality ---
      function removeProduct(indexToRemove) {
          selectedProductsData.splice(indexToRemove, 1); // Remove item from array by index
          updateSelectedProductsDisplay();
      }


      // --- Form Validation & Submission ---
      function resetValidation() {
          form.querySelectorAll('.form-control, .form-select').forEach(input => {
              input.classList.remove('is-invalid');
          });
           productSelectionError.style.display = 'none'; // Hide product error
      }

      form.addEventListener('submit', function(event) {
          event.preventDefault();
          resetValidation();

          let isValid = true;
          let correctServiceType = '';
          let correctFlightType = '';

          // Validate basic flight info
          const flightIdValue = flightIdInput.value.trim();
          if (!flightIdValue || flightIdValue.length > 7) {
              flightIdInput.classList.add('is-invalid'); isValid = false;
          }
          const originValue = originInput.value.trim();
          if (!originValue || originValue.length > 4) {
              originInput.classList.add('is-invalid'); isValid = false;
          }
          const flightTypeValueLower = flightTypeInput.value.trim().toLowerCase();
          const validFlightTypes = ['short-haul', 'medium-haul', 'long-haul'];
          if (!flightTypeValueLower || !validFlightTypes.includes(flightTypeValueLower)) {
              flightTypeInput.classList.add('is-invalid'); isValid = false;
          } else {
              correctFlightType = flightTypeValueLower;
          }
          const serviceTypeValueLower = serviceTypeInput.value.trim().toLowerCase();
          if (serviceTypeValueLower === 'retail') {
              correctServiceType = 'Retail';
          } else if (serviceTypeValueLower === 'pick & pack') {
              correctServiceType = 'Pick & Pack';
          } else {
              serviceTypeInput.classList.add('is-invalid'); isValid = false;
          }
          const passengerCountValue = parseInt(passengerCountInput.value, 10);
          if (isNaN(passengerCountValue) || passengerCountValue < 2 || passengerCountValue > 999) {
              passengerCountInput.classList.add('is-invalid'); isValid = false;
          }

          // Validate product selection
          if (selectedProductsData.length === 0) {
               productSelectionError.style.display = 'block'; // Show product error
              isValid = false;
          }

          // --- Submission ---
          if (isValid) {
              predictedFlightIdSpan.textContent = flightIdValue;
              // Show loading animation
              predictionResultArea.innerHTML = '<div class="text-center"><div class="spinner-border text-primary pulse" role="status"><span class="visually-hidden">Loading...</span></div> <p class="mt-3">Getting prediction for flight ' + flightIdValue + '</p></div>';
              // Scroll to results
              document.querySelector('.row.mt-5').scrollIntoView({ behavior: 'smooth', block: 'start' });

              // Extract product names and costs into separate lists
              const productNames = selectedProductsData.map(p => p.name);
              const unitCosts = selectedProductsData.map(p => p.cost);

              const dataToSend = {
                 flight_id: flightIdValue,
                 origin: originValue,
                 flight_type: correctFlightType,
                 service_type: correctServiceType,
                 passenger_count: passengerCountValue,
                 product_name: productNames, // Add the list of names
                 unit_cost: unitCosts       // Add the list of costs
              };

              console.log("Data to send:", dataToSend);

              // --- TODO: Add your backend API call logic here ---
              
              fetch('/api/predict', {
                 method: 'POST',
                 headers: { 'Content-Type': 'application/json' },
                 body: JSON.stringify(dataToSend)
              })
              .then(response => {
                console.log("Response status:", response.status);
                
                if (!response.ok) {
                  throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json();
              })
              .then(data => {
                console.log("Received data:", data);
                
                // Create HTML for displaying results
                let resultsHTML = `
                    <div class="card">
                        <div class="card-header">
                            <h5>Prediction Results for ${data.flight_info.origin} ${data.flight_info.flight_type} (${data.flight_info.service_type})</h5>
                            <p class="mb-0">${data.flight_info.passenger_count} passengers</p>
                        </div>
                        <div class="card-body">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>Product</th>
                                        <th>Unit Cost</th>
                                        <th>Predicted Units</th>
                                        <th>Total Cost</th>
                                    </tr>
                                </thead>
                                <tbody>
                `;
                
                data.products.forEach((product, index) => {
                    resultsHTML += `
                        <tr style="animation-delay: ${index * 0.1}s">
                            <td>${product.product_name}</td>
                            <td>$${product.unit_cost.toFixed(2)}</td>
                            <td>${product.predicted_units}</td>
                            <td>$${product.total_cost.toFixed(2)}</td>
                        </tr>
                    `;
                });
                
                resultsHTML += `
                                </tbody>
                                <tfoot class="table-dark">
                                    <tr>
                                        <th colspan="2">TOTALS</th>
                                        <th>${data.totals.total_units} units</th>
                                        <th>$${data.totals.total_cost}</th>
                                    </tr>
                                </tfoot>
                            </table>
                            <div class="row mt-3">
                                <div class="col-md-6">
                                    <p><strong>Per Passenger:</strong> ${data.totals.units_per_passenger} units</p>
                                </div>
                                <div class="col-md-6">
                                    <p><strong>Cost Per Passenger:</strong> $${data.totals.cost_per_passenger}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                predictionResultArea.innerHTML = resultsHTML;
              })
              .catch(error => {
                  predictionResultArea.innerHTML = '<p class="text-danger">Error getting prediction.</p>';
                  console.error('Prediction API Error:', error);
              });
          } else {
              predictedFlightIdSpan.textContent = "[Flight ID]";
              predictionResultArea.innerHTML = '<p class="text-danger">Please correct the errors in the form.</p>';
          }
      });

       // --- Initialize ---
      populateProductDropdown(); // Fill the dropdown on page load
      updateSelectedProductsDisplay(); // Show the initial "No products" message

      // Handle bfcache reload
      window.addEventListener('pageshow', function(event) {
        if (event.persisted) {
          window.location.reload();
        }
      });
    </script>

</body>
</html>